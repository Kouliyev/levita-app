<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEVITA OS DEBUG</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; text-align: center; }
        #loader { margin-top: 50px; }
        .error-box { 
            color: red; 
            border: 2px solid red; 
            padding: 20px; 
            background: #ffe6e6; 
            border-radius: 10px;
            margin-top: 20px;
            word-wrap: break-word;
        }
    </style>
</head>
<body>

    <div id="loader">
        <h1>‚öôÔ∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏...</h1>
        <p>–°–µ–π—á–∞—Å –º—ã —É–∑–Ω–∞–µ–º, –≤ —á–µ–º –ø—Ä–æ–±–ª–µ–º–∞.</p>
        <div id="status">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</div>
    </div>

    <div id="app" style="display:none;">
        <h1 style="color:green;">–£–†–ê! –í–°–Å –†–ê–ë–û–¢–ê–ï–¢! ü•≥</h1>
        <p>–°–≤—è–∑—å —Å –±–∞–∑–æ–π —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.</p>
        <p>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –Ω–∞–π–¥–µ–Ω—ã: <b id="count">0</b></p>
        <p>–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–π –∫–æ–¥.</p>
    </div>

    <script>
        // –¢–í–û–ò –ö–õ–Æ–ß–ò
        const SB_URL = 'https://rlwdsvttrfjcqbeunilr.supabase.co';
        const SB_KEY = 'sb_publishable_AvbjBkXGEiBVMj-58sjZnA_zt8mqBv3';

        // –§—É–Ω–∫—Ü–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        async function testConnection() {
            const statusDiv = document.getElementById('status');
            
            try {
                // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É
                if (!window.supabase) throw new Error("–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ Supabase –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å. –ü—Ä–æ–≤–µ—Ä—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.");
                
                statusDiv.innerText = "–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –µ—Å—Ç—å. –°–æ–∑–¥–∞–µ–º –∫–ª–∏–µ–Ω—Ç...";
                const supabase = window.supabase.createClient(SB_URL, SB_KEY);
                
                statusDiv.innerText = "–ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω. –°—Ç—É—á–∏–º—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö...";
                
                // 2. –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                const { data, error } = await supabase.from('employees').select('*');
                
                if (error) {
                    throw new Error("–û—à–∏–±–∫–∞ Supabase: " + error.message + " (–ö–æ–¥: " + error.code + ")");
                }

                if (!data || data.length === 0) {
                    throw new Error("–°–≤—è–∑—å –µ—Å—Ç—å, –Ω–æ —Ç–∞–±–ª–∏—Ü–∞ 'employees' –ø—É—Å—Ç–∞—è! –í—ã —Ç–æ—á–Ω–æ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ SQL –∑–∞–ø—Ä–æ—Å —Å INSERT?");
                }

                // 3. –ï—Å–ª–∏ —É—Å–ø–µ—Ö
                document.getElementById('loader').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                document.getElementById('count').innerText = data.length;

            } catch (err) {
                // 4. –í–´–í–û–î –û–®–ò–ë–ö–ò
                document.getElementById('loader').innerHTML = `
                    <div class="error-box">
                        <h3>‚ö†Ô∏è –û–®–ò–ë–ö–ê:</h3>
                        <p><b>${err.message}</b></p>
                        <hr>
                        <p><small>–°–¥–µ–ª–∞–π —Å–∫—Ä–∏–Ω—à–æ—Ç —ç—Ç–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –∏ –æ—Ç–ø—Ä–∞–≤—å –≤ —á–∞—Ç.</small></p>
                    </div>
                `;
            }
        }

        testConnection();
    </script>
</body>
</html>
